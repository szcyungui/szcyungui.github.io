---
layout:     post
title:    2020-07-03-HTTPS=HTTP+加密+认证+完整性检验
date:       2020-07-03
author:     Yungui
header-img: img/post-bg-ios9-web.jpg
catalog: true
tags: 
    - 函数式编程
    - ES6
---
# HTTP的缺陷 

1. 通信使用明文可能会被窃听 

由于 HTTP 本身不具备加密的功能，所以也无法做到对通信整体（使 

用 HTTP 协议通信的请求和响应的内容）进行加密。即，HTTP 报文 

使用明文（指未经过加密的报文）方式发送。 

TCP/IP 是可能被窃听的网络，加密处理防止被窃听，加密的对象可以有这么几个。 

### 通信的加密 

一种方式就是将通信加密。HTTP 协议中没有加密机制，但可以通过和 SSL（Secure Socket Layer，安全套接层）或TLS（Transport Layer Security，安全层传输协议）的组合使用，加密 HTTP 的通信内容。用 SSL建立安全通信线路之后，就可以在这条线路上进行 HTTP 

通信了。与 SSL组合使用的 HTTP 被称为 HTTPS（HTTP Secure，超文本传输安全协议）或 HTTP over SSL。 

### 内容的加密 

还有一种将参与通信的内容本身加密的方式。由于 HTTP 协议中没有加密机制，那么就对 HTTP 协议传输的内容本身加密。即把HTTP 报文里所含的内容进行加密处理。在这种情况下，客户端需要对 HTTP 报文进行加密处理后再发送请求。 

![图片](https://uploader.shimo.im/f/nhBhhrOUmS1M9Wi0.png!thumbnail)

诚然，为了做到有效的内容加密，前提是要求客户端和服务器同时具备加密和解密机制。主要应用在 Web 服务中。有一点必须引起注意，由于该方式不同于 SSL或 TLS 将整个通信线路加密处理，所以内容仍有被篡改的风险。稍后我们会加以说明。 


1. 不验证通信方的身份就可能遭遇伪装 

HTTP 协议中的请求和响应不会对通信方进行确认。也就是说存在“服务器是否就是发送请求中 URI 真正指定的主机，返回的响应是否真的返回到实际提出请求的客户端”等类似问题。 

### 任何人都可发起请求 

HTTP 协议的实现本身非常简单，不论是谁发送过来的请求都会返回响应，因此不确认通信方，会存在以下各种隐患。 


* 无法确定请求发送至目标的 Web 服务器是否是按真实意图返回响应的那台服务器。有可能是已伪装的 Web 服务器。 
* 无法确定响应返回到的客户端是否是按真实意图接收响应的那个客户端。有可能是已伪装的客户端。 
* 无法确定正在通信的对方是否具备访问权限。因为某些Web 服务器上保存着重要的信息，只想发给特定用户通信的权限。 

* 无法判定请求是来自何方、出自谁手。 
* 即使是无意义的请求也会照单全收。无法阻止海量请求下的 DoS 攻击（Denial of Service，拒绝服务攻击）。 
### 查明对手的证书 

虽然使用 HTTP 协议无法确定通信方，但如果使用 SSL则可以。SSL不仅提供加密处理，而且还使用了一种被称为证书的手段，可用于确定方。 

证书由值得信任的第三方机构颁发，用以证明服务器和客户端是实际存在的。另外，伪造证书从技术角度来说是异常困难的一件事。所以只要能够确认通信方（服务器或客户端）持有的证书，即可判断通信方的真实意图。 

![图片](https://uploader.shimo.im/f/tHtpuyNygYUvHgSS.png!thumbnail)


1. 无法证明报文完整性，可能已遭篡改 
### 接收到的内容可能有误 

由于 HTTP 协议无法证明通信的报文完整性，因此，在请求或响应送出之后直到对方接收之前的这段时间内，即使请求或响应的内容遭到篡改，也没有办法获悉。 

换句话说，没有任何办法确认，发出的请求 / 响应和接收到的请求 / 响应是前后相同的。 

![图片](https://uploader.shimo.im/f/RgTdDP0XBI3rpP8R.png!thumbnail)

像这样，请求或响应在传输途中，遭攻击者拦截并篡改内容的攻击称为中间人攻击（Man-in-the-Middle attack，MITM）。 

![图片](https://uploader.shimo.im/f/b26Q1LcGT1ekHWFi.png!thumbnail)

### 如何防止篡改 

虽然有使用 HTTP 协议确定报文完整性的方法，但事实上并不便捷、可靠。其中常用的是 MD5 和 SHA-1 等散列值校验的方法，以及用来确认文件的数字签名方法。 


# HTTP+ 加密 + 认证 + 完整性保护=HTTPS 


1. HTTPS 

在HTTP的协议过程中可能会出现明文传输被窃听，无法确认通信方的情况，以至于无法确认收到的报文是否被篡改等等。为了解决这个问题在HTTP的机制上再加入加密处理和认证等机制。我们把添加了加密及认证机制的HTTP成为HTTPS. 

![图片](https://uploader.shimo.im/f/AnyXrR9djmZhJ5TE.png!thumbnail)

### HTTPS 是身披 SSL 外壳的 HTTP 

HTTPS 并非是应用层的一种新协议。只是 HTTP 通信接口部分用SSL（Secure Socket Layer）和 TLS（Transport Layer Security）协议代替而已。 

通常，HTTP 直接和 TCP 通信。当使用 SSL时，则演变成先和 SSL通信，再由 SSL和 TCP 通信了。简言之，所谓 HTTPS，其实就是身披SSL协议这层外壳的 HTTP。 

![图片](https://uploader.shimo.im/f/Saki0owFuMqtJWpz.png!thumbnail)

在采用 SSL后，HTTP 就拥有了 HTTPS 的加密、证书和完整性保护这些功能。 

SSL是独立于 HTTP 的协议，所以不光是 HTTP 协议，其他运行在应用层的 SMTP 和 Telnet 等协议均可配合 SSL协议使用。可以说 SSL是当今世界上应用最为广泛的网络安全技术。 


1. 加密技术 
### 相互交换密钥的公开密钥加密技术 

SSL采用一种叫做公开密钥加密（Public-key cryptography）的加密处理方式。近代的加密方法中加密算法是公开的，而密钥却是保密的。通过这种方式得以保持加密方法的安全性。加密和解密都会用到密钥。没有密钥就无法对密码解密，反过来说，任何人只要持有密钥就能解密了。如果密钥被攻击者获得，那加密也就失去了意义。 

共享密钥加密的困境 

加密和解密同用一个密钥的方式称为共享密钥加密（Common keycrypto system），也被叫做对称密钥加密。 

![图片](https://uploader.shimo.im/f/IIYLvo2GBwk1grVV.png!thumbnail)

但是？你要怎么把密钥发送给指定的接收人呢？如果密钥发送的过程被监听那么所谓的加密也就失去了意义。 

![图片](https://uploader.shimo.im/f/piT44CZNUkXN0XW7.png!thumbnail)

### 使用两把密钥的公开密钥加密 

公开密钥加密方式很好地解决了共享密钥加密的困难。公开密钥加密使用一对非对称的密钥。一把叫做私有密钥（private key），另一把叫做公开密钥（public key）。顾名思义，私有密钥不能让其他任何人知道，而公开密钥则可以随意发布，任何人都可以获得。 

使用公开密钥加密方式，发送密文的一方使用对方的公开密钥进行加密处理，对方收到被加密的信息后，再使用自己的私有密钥进行解密。利用这种方式，不需要发送用来解密的私有密钥，也不必担心密钥被攻击者窃听而盗走。 

![图片](https://uploader.shimo.im/f/MAhfcOfc9vs7XSmv.png!thumbnail)

### HTTPS 采用混合加密机制 

HTTPS 采用共享密钥加密和公开密钥加密两者并用的混合加密机制。若密钥能够实现安全交换，那么有可能会考虑仅使用公开密钥加密来通信。但是公开密钥加密与共享密钥加密相比，其处理速度要慢。 

所以应充分利用两者各自的优势，将多种方法组合起来用于通信。在交换密钥环节使用公开密钥加密方式，之后的建立通信交换报文阶段则使用共享密钥加密方式。 

![图片](https://uploader.shimo.im/f/efs5cb3dfnZV38x1.png!thumbnail)

### 证明公开密钥正确性的证书 

到这可能有些蒙了，但是仔细思考一下，我们之前提到的每种加密技术不可避免的都需要有一次非加密操作，在共享加密中这次操作代表着需要将共享秘钥传递给对方，在相互交换的非对称加密技术中我们就需要将公开密钥公开发布，但是你依旧无法保证收到公开密钥就是正确的。 

这就用到了我们的证书了~ 

为了解决上述问题，可以使用由数字证书认证机构（CA，CertificateAuthority）和其相关机关颁发的公开密钥证书。 

数字证书认证机构的业务流程。首先，服务器的运营人员向数字证书认证机构提出公开密钥的申请。数字证书认证机构在判明提出申请者的身份之后，会对已申请的公开密钥做数字签名，然后分配这个已签名的公开密钥，并将该公开密钥放入公钥证书后绑定在一起。 

公钥证书也可叫做数字证书或直接称为证书。接到证书的客户端可使用数字证书认证机构的公开密钥，对那张证书上的数字签名进行验证，一旦验证通过，客户端便可明确两件事： 


* 认证服务器的公开密钥的是真实有效的数字证书认证机构。 
* 服务器的公开密钥是值得信赖的。 

此处认证机关的公开密钥必须安全地转交给客户端。使用通信方式时，如何安全转交是一件很困难的事，因此，多数浏览器开发商发布版本时，会事先在内部植入常用认证机关的公开密钥 

![图片](https://uploader.shimo.im/f/rliGeo6g3OjqgsHx.png!thumbnail)


1. HTTPS 的安全通信机制 
### HTTPS 的通信步骤 

![图片](https://uploader.shimo.im/f/Hnp7OYRjbM9NZDrD.png!thumbnail)

### SSL 和 TLS 

HTTPS 使用 SSL（Secure Socket Layer） 和 TLS（Transport Layer Security）这两个协议。TSL是以 SSL为原型开发的协议，有时会统一称该协议为 SSL。当前主流的版本是 SSL3.0 和 TLS1.0。 

### SSL 速度慢吗 

HTTPS 也存在一些问题，那就是当使用 SSL时，它的处理速度会变慢。 

![图片](https://uploader.shimo.im/f/U244v4Zu1s3ReXtz.png!thumbnail)

SSL的慢分两种。 

一种是指通信慢。另一种是指由于大量消耗CPU 及内存等资源，导致处理速度变慢。和使用 HTTP 相比，网络负载可能会变慢 2 到 100 倍。除去和TCP 连接、发送 HTTP 请求 • 响应以外，还必须进行 SSL通信，因此整体上处理通信量不可避免会增加。另一点是 SSL必须进行加密处理。在服务器和客户端都需要进行加密和解密的运算处理。因此从结果上讲，比起 HTTP 会更多地消耗服务器和客户端的硬件资源，导致负载增强。 

为什么不一直使用 HTTPS？ 

既然 HTTPS 那么安全可靠，那为何所有的 Web 网站不一直使用HTTPS ？其中一个原因是，因为与纯文本通信相比，加密通信会消耗更多的CPU 及内存资源。如果每次通信都加密，会消耗相当多的资源，平摊到一台计算机上时，能够处理的请求数量必定也会随之减少。因此，如果是非敏感信息则使用 HTTP 通信，只有在包含个人信息等敏感数据时，才利用 HTTPS 加密通信。 

![图片](https://uploader.shimo.im/f/ZrArXt5LlR9h5OyW.png!thumbnail)














